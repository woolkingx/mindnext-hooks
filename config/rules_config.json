{
  "version": "1.0.0",
  "description": "MindNext Hooks 規則Configuration - 支援各種觸發條件和Action",
  
  "rules": [
    {
      "id": "quality_check_on_code_edit",
      "name": "代碼編輯後自動Quality check",
      "enabled": true,
      "priority": 100,
      "event_types": ["PostToolUse"],
      "file_patterns": ["*.py", "*.js", "*.ts", "*.jsx", "*.tsx", "*.rs", "*.go"],
      "conditions": [
        {
          "expression": "tool_name in ['Edit', 'Write', 'MultiEdit']",
          "type": "simple"
        }
      ],
      "actions": [
        "action.quality/operation=check",
        "action.notification/type=console&severity=info&message=代碼Quality checkComplete"
      ],
      "cooldown_seconds": 30
    },
    
    {
      "id": "memory_record_on_completion",
      "name": "CompleteOperation後Record到Knowledge Graph",
      "enabled": true,
      "priority": 90,
      "event_types": ["PostToolUse"],
      "conditions": [
        {
          "expression": "len(file_paths) > 0",
          "type": "simple"
        }
      ],
      "actions": [
        "action.memory/operation=record&use_mindnext=true"
      ]
    },
    
    {
      "id": "ai_analysis_for_complex_operations",
      "name": "複雜Operation觸發 AI Analyze",
      "enabled": true,
      "priority": 80,
      "event_types": ["PostToolUse"],
      "conditions": [
        {
          "expression": "metadata.get('estimated_complexity') == 'complex' or len(file_paths) > 5",
          "type": "simple"
        }
      ],
      "actions": [
        "action.ai/operation=analyze_code",
        "action.analysis/type=impact",
        "action.notification/type=toast&severity=info&message=複雜OperationAnalyzeComplete"
      ]
    },
    
    {
      "id": "security_scan_on_sensitive_files",
      "name": "敏感File修改時安全掃描",
      "enabled": true,
      "priority": 95,
      "event_types": ["PostToolUse"],
      "file_patterns": ["*config*", "*secret*", "*key*", "*.env*", "*auth*"],
      "conditions": [
        {
          "expression": "tool_name in ['Edit', 'Write']",
          "type": "simple"
        }
      ],
      "actions": [
        "action.quality/operation=security_scan",
        "action.notification/type=system&title=安全Reminder&message=已對敏感File進行安全掃描"
      ],
      "block_on_fail": true
    },
    
    {
      "id": "prompt_enhancement_on_vague_input",
      "name": "模糊提示自動增強",
      "enabled": true,
      "priority": 85,
      "event_types": ["UserPromptSubmit"],
      "conditions": [
        {
          "expression": "len(user_prompt.split()) < 5 or any(word in user_prompt.lower() for word in ['這個', '那個', '改一下'])",
          "type": "simple"
        }
      ],
      "actions": [
        "action.prompt/operation=analyze",
        "action.prompt/operation=enhance&type=clarity",
        "action.notification/type=console&severity=warning&message=Detection到模糊提示，建議更具體"
      ]
    },
    
    {
      "id": "backup_on_multiple_file_changes",
      "name": "多File修改時自動備份",
      "enabled": true,
      "priority": 90,
      "event_types": ["PostToolUse"],
      "conditions": [
        {
          "expression": "len(file_paths) >= 3 and tool_name in ['Edit', 'MultiEdit', 'Delete']",
          "type": "simple"
        }
      ],
      "actions": [
        "action.utility/operation=buffer.push&buffer_id=backup&data={\"files\": file_paths, \"timestamp\": event.timestamp.isoformat()}",
        "action.notification/type=console&severity=info&message=多FileOperation已備份"
      ]
    },
    
    {
      "id": "rate_limit_rapid_operations",
      "name": "快速OperationRate limit",
      "enabled": true,
      "priority": 100,
      "event_types": ["PostToolUse"],
      "conditions": [
        {
          "expression": "True",
          "type": "simple"
        }
      ],
      "actions": [
        "action.conditional/operation=rate_limit&limit=20&window=60&key=general_operations"
      ]
    },
    
    {
      "id": "weekend_work_reminder",
      "name": "週末工作Reminder",
      "enabled": true,
      "priority": 50,
      "event_types": ["UserPromptSubmit", "PostToolUse"],
      "conditions": [
        {
          "expression": "is_weekend()",
          "type": "function"
        }
      ],
      "actions": [
        "action.notification/type=console&severity=info&message=🌴 週末愉快！注意適當休息"
      ],
      "cooldown_seconds": 1800
    },
    
    {
      "id": "test_file_creation_reminder",
      "name": "Create代碼File時Reminder添加Test",
      "enabled": true,
      "priority": 70,
      "event_types": ["PostToolUse"],
      "file_patterns": ["*.py", "*.js", "*.ts", "*.go", "*.rs"],
      "exclude_patterns": ["*test*", "*spec*"],
      "conditions": [
        {
          "expression": "tool_name == 'Write' and metadata.get('estimated_intent') == 'create'",
          "type": "simple"
        }
      ],
      "actions": [
        "action.notification/type=toast&severity=info&message=💡 建議為新代碼添加Test&duration=8000"
      ]
    },
    
    {
      "id": "dependency_check_on_package_file",
      "name": "包File修改時Dependency check",
      "enabled": true,
      "priority": 85,
      "event_types": ["PostToolUse"],
      "file_patterns": ["package.json", "requirements.txt", "Cargo.toml", "go.mod", "pom.xml"],
      "conditions": [
        {
          "expression": "tool_name in ['Edit', 'Write']",
          "type": "simple"
        }
      ],
      "actions": [
        "action.quality/operation=dependency_check",
        "action.notification/type=system&title=Dependency check&message=包File已Update，建議Check依賴"
      ]
    },
    
    {
      "id": "performance_monitoring",
      "name": "性能監控和Optimize建議",
      "enabled": true,
      "priority": 60,
      "event_types": ["PostToolUse"],
      "conditions": [
        {
          "expression": "len(file_paths) > 0",
          "type": "simple"
        }
      ],
      "actions": [
        "action.analysis/type=performance",
        "action.utility/operation=cache.set&key=last_performance_check&value=now&ttl=300"
      ],
      "cooldown_seconds": 300
    },
    
    {
      "id": "similarity_check_on_new_code",
      "name": "新代碼Similarity check",
      "enabled": true,
      "priority": 75,
      "event_types": ["PostToolUse"],
      "file_patterns": ["*.py", "*.js", "*.ts"],
      "conditions": [
        {
          "expression": "tool_name == 'Write' and len(content or '') > 100",
          "type": "simple"
        }
      ],
      "actions": [
        "action.quality/operation=similarity_check&threshold=0.7"
      ]
    },
    
    {
      "id": "work_session_analysis",
      "name": "工作SessionAnalyze",
      "enabled": true,
      "priority": 40,
      "event_types": ["PostToolUse"],
      "conditions": [
        {
          "expression": "session_count('PostToolUse', '10')",
          "type": "function"
        }
      ],
      "actions": [
        "action.analysis/type=usage",
        "action.memory/operation=summarize",
        "action.notification/type=console&severity=success&message=📊 工作SessionAnalyze已Update"
      ]
    },
    
    {
      "id": "error_circuit_breaker",
      "name": "ErrorCircuit breaker",
      "enabled": true,
      "priority": 100,
      "event_types": ["PostToolUse"],
      "conditions": [
        {
          "expression": "metadata.get('has_errors', False)",
          "type": "simple"
        }
      ],
      "actions": [
        "action.conditional/operation=circuit_breaker&failure_threshold=3&recovery_timeout=300&key=error_breaker&success=False"
      ]
    },
    
    {
      "id": "ai_keyword_extraction",
      "name": "User prompt關鍵字提取",
      "enabled": true,
      "priority": 65,
      "event_types": ["UserPromptSubmit"],
      "conditions": [
        {
          "expression": "len(user_prompt.split()) > 10",
          "type": "simple"
        }
      ],
      "actions": [
        "action.utility/operation=aisdk.extract_keywords&text={user_prompt}&max_keywords=5",
        "action.utility/operation=cache.set&key=last_keywords&value=result&ttl=600"
      ]
    },
    
    {
      "id": "buffer_flush_on_capacity",
      "name": "緩衝區容量達到時自動刷新",
      "enabled": true,
      "priority": 30,
      "event_types": ["PostToolUse"],
      "conditions": [
        {
          "expression": "True",
          "type": "simple"
        }
      ],
      "actions": [
        "action.conditional/operation=if_then&conditions=[{\"expression\": \"buffer_size > 50\", \"then_action\": \"buffer.flush\", \"action_params\": {\"buffer_id\": \"default\", \"target\": \"/root/Dev/mindnext/logs/buffer_flush.json\"}}]"
      ]
    },
    
    {
      "id": "health_check_periodic",
      "name": "定期Health check",
      "enabled": true,
      "priority": 20,
      "event_types": ["PostToolUse"],
      "conditions": [
        {
          "expression": "time_since_last('health_check', '3600')",
          "type": "function"
        }
      ],
      "actions": [
        "action.utility/operation=health_check",
        "action.analysis/type=trend"
      ]
    },
    
    {
      "id": "mindnext_integration_on_knowledge_work",
      "name": "知識工作自動整合到 MindNext",
      "enabled": true,
      "priority": 80,
      "event_types": ["PostToolUse"],
      "conditions": [
        {
          "expression": "has_keyword('mindnext') or has_keyword('qkvl') or has_keyword('8d')",
          "type": "function"
        }
      ],
      "actions": [
        "action.memory/operation=mindnext_record",
        "action.ai/operation=summarize&content={content}",
        "action.notification/type=toast&severity=success&message=已整合到 MindNext Knowledge Graph"
      ]
    },
    
    {
      "id": "cleanup_on_session_end",
      "name": "Session結束時清理",
      "enabled": true,
      "priority": 10,
      "event_types": ["SessionEnd"],
      "conditions": [
        {
          "expression": "True",
          "type": "simple"
        }
      ],
      "actions": [
        "action.utility/operation=cleanup",
        "action.memory/operation=export&format=json&date_range=today"
      ]
    }
  ],
  
  "rule_groups": {
    "quality_assurance": ["quality_check_on_code_edit", "security_scan_on_sensitive_files", "dependency_check_on_package_file"],
    "performance": ["performance_monitoring", "similarity_check_on_new_code", "buffer_flush_on_capacity"],
    "ai_enhancement": ["ai_analysis_for_complex_operations", "prompt_enhancement_on_vague_input", "ai_keyword_extraction"],
    "memory_management": ["memory_record_on_completion", "work_session_analysis", "mindnext_integration_on_knowledge_work"],
    "user_experience": ["weekend_work_reminder", "test_file_creation_reminder", "backup_on_multiple_file_changes"],
    "system_health": ["rate_limit_rapid_operations", "error_circuit_breaker", "health_check_periodic", "cleanup_on_session_end"]
  },
  
  "global_settings": {
    "max_concurrent_rules": 10,
    "default_cooldown": 0,
    "enable_rule_chaining": true,
    "log_rule_execution": true,
    "cache_rule_results": true,
    "rule_execution_timeout": 30
  },
  
  "context_variables": {
    "session_start_time": "datetime.now()",
    "user_preferences": {},
    "project_settings": {},
    "environment": "development"
  }
}