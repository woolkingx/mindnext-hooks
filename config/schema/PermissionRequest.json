{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://mindnext.dev/schema/PermissionRequest.json",
  "title": "PermissionRequest Hook API",
  "description": "權限對話框顯示時事件的完整 API 定義",
  "examples": {
    "event_example": {
      "hook_event_name": "PermissionRequest",
      "session_id": "abc-123",
      "transcript_path": "/home/user/.claude/transcripts/xyz.jsonl",
      "cwd": "/home/user/project",
      "permission_mode": "default",
      "tool_name": "Bash",
      "tool_input": {
        "command": "rm -rf /tmp"
      },
      "tool_use_id": "tool-456"
    },
    "response_allow_example": {
      "hookSpecificOutput": {
        "hookEventName": "PermissionRequest",
        "decision": {
          "behavior": "allow",
          "interrupt": false
        }
      }
    },
    "response_deny_example": {
      "hookSpecificOutput": {
        "hookEventName": "PermissionRequest",
        "decision": {
          "behavior": "deny",
          "message": "該命令過於危險",
          "interrupt": false
        }
      }
    },
    "response_transform_example": {
      "hookSpecificOutput": {
        "hookEventName": "PermissionRequest",
        "decision": {
          "behavior": "allow",
          "updatedInput": {
            "command": "trash-put /tmp"
          },
          "interrupt": false
        }
      }
    }
  },
  "definitions": {
    "event": {
      "title": "PermissionRequest Event Input",
      "description": "從 Claude Code stdin 接收的 payload",
      "x-usage": "權限對話框顯示時觸發，用於自動授予或拒絕權限",
      "x-canBlock": true,
      "type": "object",
      "required": [
        "cwd",
        "tool_input",
        "transcript_path",
        "hook_event_name",
        "session_id",
        "tool_name",
        "permission_mode"
      ],
      "properties": {
        "hook_event_name": {
          "type": "string",
          "const": "PermissionRequest"
        },
        "session_id": {
          "type": "string"
        },
        "transcript_path": {
          "type": "string"
        },
        "cwd": {
          "type": "string"
        },
        "tool_name": {
          "type": "string"
        },
        "tool_input": {
          "type": "object"
        },
        "tool_use_id": {
          "type": "string"
        },
        "permission_mode": {
          "type": "string",
          "enum": [
            "default",
            "plan",
            "acceptEdits",
            "dontAsk",
            "bypassPermissions"
          ],
          "description": "權限模式"
        }
      },
      "additionalProperties": false
    },
    "response": {
      "title": "PermissionRequest Response Output",
      "description": "輸出到 Claude Code stdout 的 JSON。此事件的權限決策方式不同於 PreToolUse",
      "type": "object",
      "required": [
        "hookSpecificOutput"
      ],
      "properties": {
        "hookSpecificOutput": {
          "type": "object",
          "required": [
            "hookEventName",
            "decision"
          ],
          "properties": {
            "hookEventName": {
              "type": "string",
              "const": "PermissionRequest",
              "description": "事件名稱 (必填)"
            },
            "decision": {
              "type": "object",
              "required": [
                "behavior"
              ],
              "properties": {
                "behavior": {
                  "type": "string",
                  "enum": [
                    "allow",
                    "deny"
                  ],
                  "description": "權限決策：allow 允許、deny 拒絕（必填）"
                },
                "updatedInput": {
                  "type": "object",
                  "description": "修改後的工具輸入（可選，allow 時）"
                },
                "message": {
                  "type": "string",
                  "description": "決策理由或警告訊息（可選，deny 時建議填寫）"
                },
                "interrupt": {
                  "type": "boolean",
                  "description": "是否中斷並顯示對話框（可選，預設 false）"
                }
              }
            }
          }
        },
        "continue": {
          "type": "boolean",
          "description": "false 完全停止 Claude（可選）"
        },
        "stopReason": {
          "type": "string",
          "description": "停止原因，給用戶顯示（可選）"
        },
        "suppressOutput": {
          "type": "boolean",
          "description": "隱藏輸出（可選）"
        },
        "systemMessage": {
          "type": "string",
          "description": "警告訊息，給用戶顯示（可選）"
        }
      },
      "additionalProperties": false
    },
    "rule": {
      "title": "PermissionRequest Rule Config",
      "type": "object",
      "required": [
        "name",
        "description",
        "enabled",
        "event"
      ],
      "properties": {
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "enabled": {
          "type": "boolean"
        },
        "event": {
          "type": "string",
          "const": "PermissionRequest"
        },
        "priority": {
          "type": "integer",
          "default": 50
        },
        "tool": {
          "type": "string"
        },
        "match": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "object"
            }
          ]
        },
        "action": {
          "type": "string",
          "enum": [
            "allow",
            "deny"
          ]
        },
        "reason": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "description": "config/rules/*.md 中的 YAML frontmatter"
    }
  },
  "oneOf": [
    {
      "$ref": "#/definitions/event"
    },
    {
      "$ref": "#/definitions/response"
    },
    {
      "$ref": "#/definitions/rule"
    }
  ]
}
