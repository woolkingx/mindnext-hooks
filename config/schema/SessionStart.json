{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://mindnext.dev/schema/SessionStart.json",
  "title": "SessionStart Hook API",
  "description": "會話開始事件的完整 API 定義\n\n根據官方 API 定義（docs/hooks-matrix.md）：\n- Input: hook_event_name, session_id, transcript_path, cwd, permission_mode (通用) + source (專用)\n- Output: hookSpecificOutput.additionalContext (string) + 通用輸出字段",
  "examples": {
    "event_example": {
      "hook_event_name": "SessionStart",
      "session_id": "abc-123",
      "transcript_path": "/home/user/.claude/transcripts/xyz.jsonl",
      "cwd": "/home/user/project",
      "permission_mode": "default",
      "source": "user",
      "model": "claude-sonnet-4.5"
    },
    "response_example": {
      "hookSpecificOutput": {
        "additionalContext": "從資料庫加載最近的 10 筆筆記和規則"
      },
      "continue": true
    },
    "rule_warmup_example": {
      "name": "session-warmup",
      "description": "會話開始時加載上下文",
      "enabled": true,
      "event": "SessionStart",
      "action": "context",
      "reason": "載入最近的筆記和規則"
    }
  },
  "definitions": {
    "event": {
      "title": "SessionStart Event Input",
      "description": "從 Claude Code stdin 接收的 payload",
      "x-usage": "新會話開始時觸發，用於初始化和上下文加載",
      "x-canBlock": false,
      "type": "object",
      "required": [
        "cwd",
        "transcript_path",
        "hook_event_name",
        "session_id"
      ],
      "properties": {
        "hook_event_name": {
          "type": "string",
          "const": "SessionStart",
          "description": "事件名稱（常數值）"
        },
        "session_id": {
          "type": "string",
          "description": "會話 ID"
        },
        "transcript_path": {
          "type": "string",
          "description": "對話記錄路徑"
        },
        "cwd": {
          "type": "string",
          "description": "當前工作目錄"
        },
        "source": {
          "type": "string",
          "description": "會話來源（user, script, etc）"
        },
        "model": {
          "type": "string",
          "description": "使用的模型名稱"
        },
        "permission_mode": {
          "type": "string",
          "enum": [
            "default",
            "plan",
            "acceptEdits",
            "dontAsk",
            "bypassPermissions"
          ],
          "description": "權限模式"
        }
      },
      "additionalProperties": false
    },
    "response": {
      "title": "SessionStart Response Output",
      "description": "輸出到 Claude Code stdout 的 JSON\n\n根據官方 API，SessionStart 輸出包含：\n- hookSpecificOutput.additionalContext (可選)\n- 通用字段: continue, stopReason, suppressOutput, systemMessage (可選)",
      "type": "object",
      "properties": {
        "hookSpecificOutput": {
          "type": "object",
          "description": "SessionStart 專用輸出",
          "required": [
            "hookEventName"
          ],
          "properties": {
            "hookEventName": {
              "type": "string",
              "const": "SessionStart",
              "description": "事件名稱 (必填)"
            },
            "additionalContext": {
              "type": "string",
              "description": "額外上下文（例如：從資料庫加載的筆記、規則等）"
            }
          },
          "additionalProperties": false
        },
        "continue": {
          "type": "boolean",
          "description": "是否繼續（false = 完全停止 Claude）。默認 true"
        },
        "stopReason": {
          "type": "string",
          "description": "停止原因（展示給用戶）"
        },
        "suppressOutput": {
          "type": "boolean",
          "description": "隱藏輸出。默認 false"
        },
        "systemMessage": {
          "type": "string",
          "description": "警告消息（展示給用戶）"
        }
      },
      "additionalProperties": false
    },
    "rule": {
      "title": "SessionStart Rule Config",
      "description": "config/rules/*.md 中的 YAML frontmatter\n\nSessionStart 支持的 action：\n- context: 添加額外上下文",
      "type": "object",
      "required": [
        "name",
        "description",
        "enabled",
        "event"
      ],
      "properties": {
        "name": {
          "type": "string",
          "description": "Rule 名稱"
        },
        "description": {
          "type": "string",
          "description": "Rule 說明"
        },
        "enabled": {
          "type": "boolean",
          "description": "是否啟用"
        },
        "event": {
          "type": "string",
          "const": "SessionStart",
          "description": "事件名稱（必須為 SessionStart）"
        },
        "priority": {
          "type": "integer",
          "default": 50,
          "description": "執行優先級（數字越大優先級越高）"
        },
        "match": {
          "oneOf": [
            {
              "type": "string",
              "description": "字串：regex 匹配 source 欄位"
            },
            {
              "type": "object",
              "description": "物件：結構化匹配"
            }
          ]
        },
        "action": {
          "type": "string",
          "enum": [
            "context"
          ],
          "description": "動作類型"
        },
        "reason": {
          "type": "string",
          "description": "動作原因"
        }
      },
      "additionalProperties": false
    }
  },
  "oneOf": [
    {
      "$ref": "#/definitions/event"
    },
    {
      "$ref": "#/definitions/response"
    },
    {
      "$ref": "#/definitions/rule"
    }
  ]
}
